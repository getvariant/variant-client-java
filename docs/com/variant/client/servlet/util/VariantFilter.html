<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_191) on Mon Dec 30 18:15:52 MST 2019 -->
<title>VariantFilter (Variant 0.10.3)</title>
<meta name="date" content="2019-12-30">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="VariantFilter (Variant 0.10.3)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><a onclick="window.top.location.href='http://getvariant.com';" href="#"> <img style="margin-bottom:5px;" src="http://getvariant.com/wp-content/uploads/2016/05/VariantLogoSmall.png"/> \</a></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/variant/client/servlet/util/VariantCookie.html" title="class in com.variant.client.servlet.util"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../com/variant/client/servlet/util/VariantWebUtils.html" title="class in com.variant.client.servlet.util"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/variant/client/servlet/util/VariantFilter.html" target="_top">Frames</a></li>
<li><a href="VariantFilter.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.variant.client.servlet.util</div>
<h2 title="Class VariantFilter" class="title">Class VariantFilter</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>com.variant.client.servlet.util.VariantFilter</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">VariantFilter</span>
extends java.lang.Object</pre>
<div class="block"><p>The preferred way of instrumenting Variant experiments for host applications written on top of the Java Servlet API.
 
 <h4>Overview</h4> 

 <p>By using this filter, the application programmer can, in many cases, instrument experiments
 with no to very little coding. The filter intercepts HTTP requests for the instrumented
 pages, obtains the resolved variant and, if non-control, forwards the request to the path
 contained in the resolved state parameter <code>path</code>.
 
 <p>The application programmer should use this filter if the following assumptions hold:
 <ul>
 <li>The host applicaiton is written on top of the Servlet API.
 <li>All state variants have a single point of entry, which can be mapped to a request path.
 <li>The test schema defines the <code>path</code> state parameter, so that 1) its base value 
 denotes the resource path to the this state's control; and 2) its variant value denotes the 
 resource path to the single point of entry of that state variant.
 </ul>
 
 <h4>Configuration</h4>
 <p>The filter is configured as following:
 <pre>
 <code>
  &lt;filter&gt;
      &lt;filter-name&gt;variantFilter&lt;/filter-name&gt;
      &lt;filter-class&gt;com.variant.client.servlet.VariantFilter&lt;/filter-class&gt; 
      &lt;init-param&gt;
          &lt;param-name&gt;schemaResourceName&lt;/param-name&gt;
          &lt;param-value&gt;/path/to/schema.json&lt;/param-value&gt;
      &lt;/init-param&gt;
      &lt;init-param&gt;
          &lt;param-name&gt;propsResourceName&lt;/param-name&gt;
          &lt;param-value&gt;/path/to/variant.props&lt;/param-value&gt;
      &lt;/init-param&gt;
  &lt;/filter&gt;
   
  &lt;filter-mapping&gt;
      &lt;filter-name&gt;variantFilter&lt;/filter-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
 </code>
 </pre>

 The <a href="../../../../../com/variant/client/servlet/util/VariantFilter.html#init-FilterConfig-"><code>init(FilterConfig)</code></a> method looks for two initialization parameters:
 <ul>
 <li><code>schemaResourceName</code>: Name of the schema file as a classpath resource. 
 Parsed once during filter initialization. To change a schema, application restart will be required. 
 (Temporary limitaion to be removed in an upcoming version.)
 
 <li><code>propsResourceName</code>: Name of the application properties file as a
 classpath resource. Its content will override default properties, but will be overridden
 by <code>/varaint.props</code>, if found on the classpath.
 </ul>
 
 <p>The URL pattern in filter mapping can be something narrower than <code>/*</code>, of course, so long
 as it matches all state <code>path</code>s listed in the schema.
 
 <p><code>StateParsedHookListenerImpl</code> hook listener is registered prior to parsing of the schema,
 which checks that each state defines the <code>path</code> parameter and that its value starts with a
 forward slash. If that is not the case, a parser error will be emitted by the listener.
 
 <h4>Execution Semantics</h4>
 
 <p>It is assumed that the base <code>path</code> state parameter, i.e. the one specified at the <code>State</code>
 level, denotes the resource path to the control variation of this state. This allows this filter to
 identify whether an incoming HTTP request is for an instrumented state or not.  If not, the request
 is forwarded down the filter chain by calling <code>chain.doFilter(ServletRequest, ServletResponse)</code>.
 
 <p>If the requested path corresponds to an instrumented state, the session (obtained from 
 Variant client servlet adapter by calling <code>ServletVariantClient#getOrCreateSession(HttpServletRequest)</code>) 
 is targeted for this state with <a href="../../../../../com/variant/client/servlet/ServletSession.html#targetForState-com.variant.share.schema.State-"><code>ServletSession.targetForState(State)</code></a>. The resulting
 <a href="../../../../../com/variant/client/servlet/ServletStateRequest.html" title="interface in com.variant.client.servlet"><code>ServletStateRequest</code></a> object contains information about the outcome of the targeting
 operation, including the resulting variant and the resolved state parameters. This 
 <a href="../../../../../com/variant/client/servlet/ServletStateRequest.html" title="interface in com.variant.client.servlet"><code>ServletStateRequest</code></a> object is added to the current <code>HttpServletRequest</code> as
 an attribute named <code>#VARIANT_REQUEST_ATTRIBUTE_NAME</code>, should the downstream application code 
 wish to extend the semantics, e.g. trigger a custom <code>VariantEvent</code>.  
 
 <p>The resolved variant's <code>path</code> 
 state parameter is interpreted as the request path to the resource which implements the targeted
 variant. The request is forwarded to that path with <code>ServletRequestDispatcher.forward()</code>.
 
 <p>Upon return from either forward or a fall-through down the filter chain, the 
 <a href="../../../../../com/variant/client/servlet/util/VariantFilter.html#doFilter-ServletRequest-ServletResponse-FilterChain-"><code>doFilter(ServletRequest, ServletResponse, FilterChain)</code></a> method below adds the status of the
 HTTP response in progress to the pending state visited event and commits the Variant state request
 in progress.
 
 <p>Any exceptions due to Variant are caught and logged. Should such an exception occur, an attempt
 is made to mark the state of the pending state visited event as failed and to allow the request
 proceed down the filter chain. In other words, should the instrumentation fail due to an internal
 Varaint exception, the user session will see the control experience.</div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>0.5</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/variant/client/servlet/util/VariantFilter.html#VARIANT_REQUEST_ATTR_NAME">VARIANT_REQUEST_ATTR_NAME</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../com/variant/client/servlet/util/VariantFilter.html#VariantFilter--">VariantFilter</a></span>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/variant/client/servlet/util/VariantFilter.html#destroy--">destroy</a></span>()</code>&nbsp;</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/variant/client/servlet/util/VariantFilter.html#doFilter-ServletRequest-ServletResponse-FilterChain-">doFilter</a></span>(ServletRequest&nbsp;request,
        ServletResponse&nbsp;response,
        FilterChain&nbsp;chain)</code>
<div class="block">Identify the state, target and commit the state request.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/variant/client/servlet/util/VariantFilter.html#init-FilterConfig-">init</a></span>(FilterConfig&nbsp;config)</code>
<div class="block">Initialize the Variant servlet adapter and parse the experiment schema.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/variant/client/servlet/util/VariantFilter.html#onSession-ServletRequest-ServletResponse-com.variant.client.servlet.ServletSession-">onSession</a></span>(ServletRequest&nbsp;request,
         ServletResponse&nbsp;response,
         <a href="../../../../../com/variant/client/servlet/ServletSession.html" title="interface in com.variant.client.servlet">ServletSession</a>&nbsp;ssn)</code>
<div class="block">On session callback method.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/variant/client/servlet/util/VariantFilter.html#onStateRequest-ServletRequest-ServletResponse-com.variant.client.servlet.ServletStateRequest-">onStateRequest</a></span>(ServletRequest&nbsp;request,
              ServletResponse&nbsp;response,
              <a href="../../../../../com/variant/client/servlet/ServletStateRequest.html" title="interface in com.variant.client.servlet">ServletStateRequest</a>&nbsp;stateRequest)</code>
<div class="block">On session callback method.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="VARIANT_REQUEST_ATTR_NAME">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>VARIANT_REQUEST_ATTR_NAME</h4>
<pre>public static final&nbsp;java.lang.String VARIANT_REQUEST_ATTR_NAME</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#com.variant.client.servlet.util.VariantFilter.VARIANT_REQUEST_ATTR_NAME">Constant Field Values</a></dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="VariantFilter--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>VariantFilter</h4>
<pre>public&nbsp;VariantFilter()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="onSession-ServletRequest-ServletResponse-com.variant.client.servlet.ServletSession-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>onSession</h4>
<pre>protected&nbsp;void&nbsp;onSession(ServletRequest&nbsp;request,
                         ServletResponse&nbsp;response,
                         <a href="../../../../../com/variant/client/servlet/ServletSession.html" title="interface in com.variant.client.servlet">ServletSession</a>&nbsp;ssn)</pre>
<div class="block">On session callback method. Extending client classes may add custom semantics by overriding
 this method. Otherwise, the default implementation does nothing.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>ssn</code> - The newly acquired Variant session object.</dd>
</dl>
</li>
</ul>
<a name="onStateRequest-ServletRequest-ServletResponse-com.variant.client.servlet.ServletStateRequest-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>onStateRequest</h4>
<pre>protected&nbsp;void&nbsp;onStateRequest(ServletRequest&nbsp;request,
                              ServletResponse&nbsp;response,
                              <a href="../../../../../com/variant/client/servlet/ServletStateRequest.html" title="interface in com.variant.client.servlet">ServletStateRequest</a>&nbsp;stateRequest)</pre>
<div class="block">On session callback method. Extending client classes may add custom semantics by overriding
 this method. Otherwise, the default implementation does nothing.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>ssn</code> - The newly acquired Variant session object.</dd>
</dl>
</li>
</ul>
<a name="init-FilterConfig-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>init</h4>
<pre>public&nbsp;void&nbsp;init(FilterConfig&nbsp;config)
          throws ServletException</pre>
<div class="block">Initialize the Variant servlet adapter and parse the experiment schema.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>ServletException</code></dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>0.5</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><code>Filter#init(FilterConfig)</code></dd>
</dl>
</li>
</ul>
<a name="doFilter-ServletRequest-ServletResponse-FilterChain-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>doFilter</h4>
<pre>public&nbsp;void&nbsp;doFilter(ServletRequest&nbsp;request,
                     ServletResponse&nbsp;response,
                     FilterChain&nbsp;chain)
              throws java.io.IOException,
                     ServletException</pre>
<div class="block">Identify the state, target and commit the state request.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code>ServletException</code></dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><code>Filter#doFilter(ServletRequest, ServletResponse, FilterChain)</code></dd>
</dl>
</li>
</ul>
<a name="destroy--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>destroy</h4>
<pre>public&nbsp;void&nbsp;destroy()</pre>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><code>Filter#destroy()</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><a onclick="window.top.location.href='http://getvariant.com';" href="#"> <img style="margin-bottom:5px;" src="http://getvariant.com/wp-content/uploads/2016/05/VariantLogoSmall.png"/> \</a></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/variant/client/servlet/util/VariantCookie.html" title="class in com.variant.client.servlet.util"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../com/variant/client/servlet/util/VariantWebUtils.html" title="class in com.variant.client.servlet.util"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/variant/client/servlet/util/VariantFilter.html" target="_top">Frames</a></li>
<li><a href="VariantFilter.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Release 0.10.3. Updated 30 Dec 2019.<br/> Copyright &copy; 2019 <a onclick="window.top.location.href='http://getvariant.com';" href="#">Variant Inc.</a></small></p>
</body>
</html>
